â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TODOLIST - MODULE SIMULATION & DISTRIBUTION - RECONSTRUCTION COMPLÃˆTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PHASE 1 : BASE DE DONNÃ‰ES (Estimation: 15min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1.1 CrÃ©er la table `bngrc_distribution`
    â–¡ Colonnes : id (PK AUTO_INCREMENT), don_id (FK), besoin_id (FK)
    â–¡ Colonnes : quantite (INT), date_distribution (DATE)
    â–¡ Colonnes : est_simulation (BOOLEAN DEFAULT TRUE)
    â–¡ Index : INDEX(don_id), INDEX(besoin_id), INDEX(date_distribution), INDEX(est_simulation)
    â–¡ Constraint FK : FOREIGN KEY(don_id) REFERENCES bngrc_dons(id)
    â–¡ Constraint FK : FOREIGN KEY(besoin_id) REFERENCES bngrc_besoin(id)
    â± Temps estimÃ© : 5 min
    âœ“ Ã‰tat initial : table vide, 0 ligne

1.2 CrÃ©er la vue `v_bngrc_distributions`
    â–¡ SELECT dist.*, d.type_article_id, d.donateur, b.ville_id
    â–¡ v.nom AS ville_nom, r.nom AS region_nom
    â–¡ ta.nom AS article_nom, ta.categorie, ta.prix_unitaire, ta.unite
    â–¡ FROM bngrc_distribution dist
    â–¡ JOIN bngrc_dons d ON dist.don_id = d.id
    â–¡ JOIN bngrc_besoin b ON dist.besoin_id = b.id
    â–¡ JOIN bngrc_ville v ON b.ville_id = v.id
    â–¡ JOIN bngrc_region r ON v.idregion = r.id
    â–¡ JOIN bngrc_type_articles ta ON d.type_article_id = ta.id
    â± Temps estimÃ© : 4 min
    âœ“ Ã‰tat initial : vue vide car table distributions vide

1.3 CrÃ©er les vues d'optimisation pour la simulation
    â–¡ v_bngrc_besoins_avec_articles : besoins + catÃ©gorie + prix_unitaire
    â–¡ v_bngrc_dons_disponibles_par_type : dons + quantite_disponible calculÃ©e
    â–¡ v_bngrc_resume_simulation : COUNT, SUM quantitÃ©, SUM montant (hors argent)
    â± Temps estimÃ© : 6 min
    âœ“ Ã‰tat initial : vues vides, utilisÃ©es par algorithme de simulation


ğŸ“‹ PHASE 2 : MODÃˆLES (Estimation: 25min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2.1 CrÃ©er Distribution.php (app/models/)
    â–¡ Namespace models, use PDO
    â–¡ Properties PRIVÃ‰ES : id, don_id, besoin_id, quantite, date_distribution, est_simulation
    â–¡ Constructor vide : public function __construct() {}
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : classe vide, aucune distribution en DB

2.2 Getters Distribution.php
    â–¡ getId(): ?int
    â–¡ getDonId(): ?int
    â–¡ getBesoinId(): ?int
    â–¡ getQuantite(): ?int
    â–¡ getDateDistribution(): ?string
    â–¡ isSimulation(): ?bool
    â± Temps estimÃ© : 2 min

2.3 Setters Distribution.php (fluent interface)
    â–¡ setId(?int $id): self { $this->id = $id; return $this; }
    â–¡ setDonId(?int $don_id): self
    â–¡ setBesoinId(?int $besoin_id): self
    â–¡ setQuantite(?int $quantite): self
    â–¡ setDateDistribution(?string $date_distribution): self
    â–¡ setEstSimulation(?bool $est_simulation): self
    â± Temps estimÃ© : 2 min

2.4 MÃ©thodes CRUD Distribution.php
    â–¡ create(PDO $db): bool - INSERT avec prepared statement
    â–¡ findById(PDO $db, int $id): ?Distribution - SELECT avec setters
    â–¡ static fromArray(array $data): Distribution - helper construction
    â–¡ findAllComplete(PDO $db): array - SELECT * FROM v_bngrc_distributions
    â–¡ findSimulations(PDO $db): array - WHERE est_simulation = TRUE
    â–¡ findValidees(PDO $db): array - WHERE est_simulation = FALSE
    â–¡ delete(PDO $db): bool - DELETE FROM bngrc_distribution WHERE id
    â± Temps estimÃ© : 7 min
    âœ“ Ã‰tat initial DB : 0 distributions aprÃ¨s findAll()

2.5 MÃ©thodes mÃ©tier Distribution.php (cÅ“ur de la simulation)
    â–¡ static supprimerSimulations(PDO $db): bool - DELETE WHERE est_simulation = TRUE
    â–¡ static validerSimulations(PDO $db): bool - UPDATE SET est_simulation = FALSE WHERE est_simulation = TRUE
    â–¡ static simulerDistribution(PDO $db): array - ALGORITHME COMPLEXE :
        1. Supprimer anciennes simulations
        2. RÃ©cupÃ©rer besoins via v_bngrc_besoins_avec_articles (WHERE categorie != 'argent', ORDER BY date_demande)
        3. Pour chaque besoin :
            a. Calculer quantite_restante (besoin.quantite - SUM distributions validÃ©es)
            b. RÃ©cupÃ©rer dons via v_bngrc_dons_disponibles_par_type (WHERE type_article_id = besoin.type_article_id)
            c. Pour chaque don disponible :
                - quantiteADistribuer = MIN(quantite_restante, don.quantite_disponible)
                - CrÃ©er Distribution avec est_simulation = TRUE
                - DÃ©crÃ©menter quantite_restante
        4. Retourner array des distributions crÃ©Ã©es
    â–¡ static getResumeSimulation(PDO $db): array - SELECT * FROM v_bngrc_resume_simulation
    â± Temps estimÃ© : 12 min
    âœ“ Logique complexe : dispatch optimal, ordre FIFO, gestion quantitÃ©s


ğŸ“‹ PHASE 3 : CONTRÃ”LEUR (Estimation: 20min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3.1 CrÃ©er SimulationController.php (app/controllers/)
    â–¡ Namespace controllers
    â–¡ use models\Besoin, models\Don, models\Distribution, models\Achat
    â–¡ use Flight, PDO
    â–¡ TOUS LES MÃ‰THODES STATIC : public static function
    â–¡ Pas de constructor, pas de $this->db
    â–¡ Utiliser Flight::db() dans chaque mÃ©thode
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : aucun controller, pas de routes

3.2 MÃ©thode showSimulation()
    â–¡ public static function showSimulation(): void
    â–¡ $db = Flight::db()
    â–¡ $simulationsData = Distribution::findSimulations($db)
    â–¡ $hasSimulation = !empty($simulationsData)
    â–¡ if ($hasSimulation) { $besoinsData = Besoin::findBesoinsAvecSimulation($db); }
    â–¡ else { $besoinsData = Besoin::findBesoinsNonSatisfaits($db); }
    â–¡ Boucle foreach $besoinsData : calculer progression (ratio_display, progress_class, progress_width, is_projected)
    â–¡ LOGIQUE PROGRESSION :
        - Si hasSimulation && ratio_satisfaction_avec_simulation : ratio_display = ratio_avec_simulation, is_projected = true
        - Sinon : ratio_display = ratio_satisfaction, is_projected = false
        - progress_class : >= 100 ? 'progress-complete' : (>= 50 ? 'progress-partial' : 'progress-low')
        - progress_width : min(ratio_display, 100)
    â–¡ $donsData = Don::findAllDisponibles($db)
    â–¡ $distribueesData = Distribution::findValidees($db)
    â–¡ $resumeSimulation = Distribution::getResumeSimulation($db)
    â–¡ Flight::render('simulation/index', [...])
    â± Temps estimÃ© : 6 min
    âœ“ Ã‰tat initial : affichera 0 distributions (DB vide), besoins non satisfaits

3.3 MÃ©thode simuler() (AJAX)
    â–¡ public static function simuler(): void
    â–¡ $db = Flight::db()
    â–¡ try { $resultats = Distribution::simulerDistribution($db); }
    â–¡ $resume = Distribution::getResumeSimulation($db)
    â–¡ $simulations = Distribution::findSimulations($db)
    â–¡ Flight::json(['success' => true, 'message' => '...', 'nb_distributions' => count($resultats), ...])
    â–¡ catch { Flight::json(['success' => false, 'message' => ...], 500); }
    â± Temps estimÃ© : 3 min

3.4 MÃ©thode valider() (AJAX)
    â–¡ public static function valider(): void
    â–¡ $db = Flight::db()
    â–¡ try { Distribution::validerSimulations($db); Achat::validerTous($db); }
    â–¡ Flight::json(['success' => true, 'message' => 'Distribution validÃ©e avec succÃ¨s !'])
    â–¡ catch { Flight::json(['success' => false, ...], 500); }
    â± Temps estimÃ© : 3 min
    âœ“ Valide distributions + achats en mÃªme temps

3.5 MÃ©thode annuler() (AJAX)
    â–¡ public static function annuler(): void
    â–¡ $db = Flight::db()
    â–¡ try { Distribution::supprimerSimulations($db); }
    â–¡ Flight::json(['success' => true, 'message' => 'Simulation annulÃ©e'])
    â–¡ catch { Flight::json(['success' => false, ...], 500); }
    â± Temps estimÃ© : 2 min

3.6 MÃ©thode getEtat() (AJAX)
    â–¡ public static function getEtat(): void
    â–¡ $db = Flight::db()
    â–¡ $simulations = Distribution::findSimulations($db)
    â–¡ $resume = Distribution::getResumeSimulation($db)
    â–¡ $besoins = Besoin::findBesoinsNonSatisfaits($db)
    â–¡ Flight::json(['success' => true, 'simulations' => ..., 'resume' => ..., 'besoins' => ...])
    â± Temps estimÃ© : 2 min

3.7 MÃ©thode RecapController::showRecap() et getRecapAjax()
    â–¡ Controller sÃ©parÃ© pour la rÃ©capitulation
    â–¡ public static function showRecap(): void - afficher vue recap/index
    â–¡ public static function getRecapAjax(): void - retourner JSON pour refresh AJAX
    â–¡ private static function getRecapData(): array - calculer toutes les stats :
        - v_bngrc_recapitulatif_besoins (montant total, satisfait, restant)
        - Dons disponibles (SUM), dons nature, dons argent
        - Argent disponible (v_bngrc_argent_disponible)
        - Achats validÃ©s, achats en attente
        - Distributions en simulation
        - Stats par catÃ©gorie
        - Nombre besoins, nombre besoins satisfaits
        - Ratio global
    â± Temps estimÃ© : 2 min (dÃ©jÃ  existant)


ğŸ“‹ PHASE 4 : VUES (Estimation: 25min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4.1 CrÃ©er index.php (app/views/simulation/)
    â–¡ <?php include header, link CSS simulation.css
    â–¡ H1 : âš™ï¸ Simulation & Distribution
    â–¡ Explication 3 Ã©tapes : SIMULER â†’ VÃ©rifier â†’ DISTRIBUER
    â–¡ Boutons actions :
        - btn-simuler : onclick="simuler()" (AJAX)
        - btn-distribuer : onclick="valider()" (AJAX), disabled si !simulations
        - btn-annuler : onclick="annuler()" (AJAX), visible si simulations
    â–¡ Div loading : style="display:none", affichÃ© pendant AJAX
    â± Temps estimÃ© : 5 min

4.2 Info-cards simulation/index.php
    â–¡ 4 info-cards : dons disponibles, besoins non satisfaits, distributions en simulation, distributions validÃ©es
    â–¡ Couleurs : blue, purple, orange, green
    â–¡ Valeurs dynamiques : count($dons), count($besoins), count($simulations), count($distribuees)
    â–¡ Update via AJAX aprÃ¨s simuler()
    â± Temps estimÃ© : 3 min

4.3 Simulation preview dans simulation/index.php
    â–¡ AffichÃ©e si !empty($simulations)
    â–¡ Div .simulation-preview : fond orange, "âš ï¸ Simulation en cours - Non validÃ©e"
    â–¡ Table : Don #, Donateur, â†’, Besoin #, Ville, Article, QuantitÃ©, Statut
    â–¡ Badge "En simulation" (orange)
    â–¡ Tbody foreach $simulations
    â± Temps estimÃ© : 4 min

4.4 Table dons disponibles dans simulation/index.php
    â–¡ H3 : ğŸ“¦ Dons disponibles (non distribuÃ©s)
    â–¡ Empty state si empty($dons) : "Aucun don disponible" + lien "Ajouter un don"
    â–¡ Table : Don #, Date, Donateur, Article, CatÃ©gorie, QuantitÃ© totale, Disponible
    â–¡ Badge catÃ©gorie : badge-<?php echo $cat; ?>
    â–¡ Tbody foreach $dons
    â± Temps estimÃ© : 4 min

4.5 Table besoins non satisfaits dans simulation/index.php
    â–¡ H3 : ğŸ“‹ Besoins non satisfaits
    â–¡ Empty state si empty($besoins) : "âœ… Tous les besoins sont satisfaits !"
    â–¡ Table : Besoin #, Date, Ville, Article, CatÃ©gorie, DemandÃ©, ReÃ§u, Restant, Satisfaction
    â–¡ Colonne Satisfaction : barre de progression CALCULÃ‰E DANS LE CONTROLLER
        - Utiliser $besoin['progress_class'], $besoin['progress_width'], $besoin['ratio_display']
        - Afficher ğŸ“Š si $besoin['is_projected'] (simulation en cours)
    â–¡ Classes progress : .progress-complete (vert), .progress-partial (orange), .progress-low (rouge)
    â–¡ Tbody foreach $besoins
    â± Temps estimÃ© : 5 min

4.6 Table distributions validÃ©es dans simulation/index.php
    â–¡ H3 : âœ… Distributions validÃ©es (rÃ©centes)
    â–¡ AffichÃ©e si !empty($distribuees)
    â–¡ Table : Date, Don #, Donateur, â†’, Besoin #, Ville, Article, QuantitÃ©
    â–¡ Afficher seulement 10 derniÃ¨res : array_slice($distribuees, 0, 10)
    â–¡ Tbody foreach $distribuees
    â± Temps estimÃ© : 3 min

4.7 CSS simulation.css
    â–¡ .simulation-box { background: #fff3cd; border: 2px solid #ffc107; padding: 20px; }
    â–¡ .simulation-preview { background: #ffe5b4; border: 2px solid #ff9800; }
    â–¡ .badge-simulation { background: #ff9800; color: white; }
    â–¡ .progress-bar-container { width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; }
    â–¡ .progress-bar { height: 100%; border-radius: 10px; text-align: center; color: white; font-weight: bold; }
    â–¡ .progress-complete { background: #28a745; }
    â–¡ .progress-partial { background: #ffc107; color: #333; }
    â–¡ .progress-low { background: #dc3545; }
    â–¡ .info-cards, .info-card (blue, purple, orange, green)
    â–¡ .loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; }
    â± Temps estimÃ© : 1 min


ğŸ“‹ PHASE 5 : JAVASCRIPT (Estimation: 18min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5.1 CrÃ©er simulation.js (public/assets/js/)
    â–¡ DÃ©clarer baseURL : const baseURL = window.BASE_URL || '';
    â–¡ Fonction simuler() : fetch POST baseURL + '/simulation/simuler'
    â–¡ Afficher loading pendant AJAX
    â–¡ Si success : alert succÃ¨s, recharger page (location.reload())
    â–¡ Si error : alert erreur
    â–¡ Cacher loading aprÃ¨s AJAX
    â± Temps estimÃ© : 5 min

5.2 Fonction valider() dans simulation.js
    â–¡ Confirm : "ÃŠtes-vous sÃ»r de vouloir DISTRIBUER dÃ©finitivement ?"
    â–¡ fetch POST baseURL + '/simulation/valider'
    â–¡ Afficher loading
    â–¡ Si success : alert succÃ¨s, recharger page
    â–¡ Si error : alert erreur
    â–¡ Cacher loading
    â± Temps estimÃ© : 4 min

5.3 Fonction annuler() dans simulation.js
    â–¡ Confirm : "Annuler la simulation en cours ?"
    â–¡ fetch POST baseURL + '/simulation/annuler'
    â–¡ Afficher loading
    â–¡ Si success : recharger page (sans alert)
    â–¡ Si error : alert erreur
    â–¡ Cacher loading
    â± Temps estimÃ© : 4 min

5.4 Fonction refreshEtat() dans simulation.js (optionnel)
    â–¡ fetch GET baseURL + '/simulation/etat'
    â–¡ Mettre Ã  jour info-cards dynamiquement (sans reload)
    â–¡ Mettre Ã  jour nb_simulations dans DOM
    â–¡ Mettre Ã  jour preview simulation
    â–¡ Appeler aprÃ¨s simuler() pour update immÃ©diat
    â± Temps estimÃ© : 5 min (optionnel, amÃ©lioration UX)


ğŸ“‹ PHASE 6 : ROUTES (Estimation: 3min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6.1 DÃ©clarer routes simulation (app/routes.php)
    â–¡ use controllers\SimulationController
    â–¡ Flight::route('GET /simulation', [SimulationController::class, 'showSimulation'])
    â–¡ Flight::route('POST /simulation/simuler', [SimulationController::class, 'simuler'])
    â–¡ Flight::route('POST /simulation/valider', [SimulationController::class, 'valider'])
    â–¡ Flight::route('POST /simulation/annuler', [SimulationController::class, 'annuler'])
    â–¡ Flight::route('GET /simulation/etat', [SimulationController::class, 'getEtat'])
    â± Temps estimÃ© : 3 min
    âœ“ Ã‰tat initial : routes non dÃ©clarÃ©es


ğŸ“‹ PHASE 7 : INTÃ‰GRATION MENU (Estimation: 2min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

7.1 Ajouter lien Simulation dans header.php
    â–¡ Ouvrir app/views/includes/header.php
    â–¡ Ajouter <a href="<?php echo $baseurl; ?>/simulation" class="<?php echo $active == 'simulation' ? 'active' : ''; ?>">
        âš™ï¸ Simulation
      </a>
    â–¡ Entre Achats et RÃ©capitulation
    â± Temps estimÃ© : 2 min


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RÃ‰SUMÃ‰ Ã‰TAT INITIAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Base de donnÃ©es : Table bngrc_distribution VIDE (0 ligne)
âœ“ Vues : v_bngrc_distributions, v_bngrc_besoins_avec_articles, v_bngrc_dons_disponibles_par_type, v_bngrc_resume_simulation
âœ“ Model Distribution.php : findSimulations() retourne array vide []
âœ“ Controller : showSimulation() affichera 0 distributions en simulation
âœ“ Vue simulation/index.php : affiche besoins non satisfaits, dons disponibles, 0 simulation
âœ“ Bouton SIMULER : dÃ©clenche algorithme de distribution automatique
âœ“ AprÃ¨s simuler() : DB passe de 0 Ã  N distributions (est_simulation = TRUE)
âœ“ Bouton DISTRIBUER : UPDATE est_simulation = FALSE (validation)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FONCTIONNALITÃ‰S CLÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Algorithme de simulation (dispatch optimal)
   â–¡ Objectif : distribuer automatiquement les dons aux besoins
   â–¡ Logique :
       1. RÃ©cupÃ©rer besoins non satisfaits (hors argent), triÃ©s par date_demande ASC (FIFO)
       2. Pour chaque besoin :
           a. Calculer quantite_restante = quantite_demandee - quantite_recue_validee
           b. RÃ©cupÃ©rer dons disponibles du mÃªme type_article, triÃ©s par date_don ASC (FIFO)
           c. Pour chaque don :
               - Distribuer MIN(quantite_restante, don.quantite_disponible)
               - CrÃ©er Distribution avec est_simulation = TRUE
               - DÃ©crÃ©menter quantite_restante
           d. Si quantite_restante > 0 : passer au don suivant
       3. Retourner liste des distributions crÃ©Ã©es
   â–¡ Contraintes : HORS ARGENT (categorie != 'argent'), FIFO sur besoins et dons
   â–¡ Optimisation : utiliser vues SQL pour performance
   âœ“ Ã‰volution DB : 0 â†’ N distributions en simulation

2. PrÃ©visualisation simulation
   â–¡ Affichage table : distributions en attente (est_simulation = TRUE)
   â–¡ Badge orange "En simulation"
   â–¡ Ratio projetÃ© dans besoins : utilise ratio_satisfaction_avec_simulation (inclut simulations)
   â–¡ IcÃ´ne ğŸ“Š pour indiquer projection
   â–¡ Bouton DISTRIBUER actif uniquement si simulations en cours
   âœ“ UX : utilisateur voit projection avant validation

3. Validation simulation
   â–¡ Bouton DISTRIBUER : UPDATE bngrc_distribution SET est_simulation = FALSE
   â–¡ Ã‰galement : Achat::validerTous($db) - validation achats en attente
   â–¡ Confirm JS : "ÃŠtes-vous sÃ»r ?"
   â–¡ AJAX : pas de reload pendant traitement
   â–¡ AprÃ¨s validation : distributions dÃ©finitives, besoins satisfaits
   âœ“ Ã‰volution : distributions simulation â†’ distributions validÃ©es

4. Annulation simulation
   â–¡ Bouton Annuler : DELETE FROM bngrc_distribution WHERE est_simulation = TRUE
   â–¡ Confirm JS : "Annuler la simulation en cours ?"
   â–¡ Revenir Ã  l'Ã©tat initial : 0 distributions en simulation
   â–¡ Ratio redevient ratio_satisfaction (sans projection)
   âœ“ Permet de recommencer la simulation

5. Gestion des barres de progression
   â–¡ CalculÃ©es dans CONTROLLER (pas dans vue)
   â–¡ Variables fournies : ratio_display, progress_class, progress_width, is_projected
   â–¡ Classes CSS : progress-complete (vert, >= 100%), progress-partial (orange, >= 50%), progress-low (rouge, < 50%)
   â–¡ Si simulation en cours : utilise ratio_satisfaction_avec_simulation + ğŸ“Š
   â–¡ Sinon : utilise ratio_satisfaction
   âœ“ SÃ©paration responsabilitÃ©s : logique backend, affichage frontend

6. IntÃ©gration avec achats
   â–¡ Valider simulation â†’ valider aussi achats en attente
   â–¡ Achats validÃ©s crÃ©ent dons + distributions automatiquement
   â–¡ Synchronisation : distributions (dons) + achats (crÃ©ation dons) = satisfaction besoins complÃ¨te
   âœ“ CohÃ©rence globale du systÃ¨me

7. AJAX et UX
   â–¡ simulation.js : fetch avec baseURL
   â–¡ Afficher loading pendant traitement
   â–¡ Alerts succÃ¨s/erreur
   â–¡ Reload aprÃ¨s action (simplification, Ã©vite sync complexe)
   â–¡ Confirm avant actions critiques (valider, annuler)
   âœ“ UX fluide, feedback utilisateur

8. RÃ©capitulation (module liÃ©)
   â–¡ RecapController : stats globales (montant total, satisfait, restant)
   â–¡ Vue recap/index.php : affichage dashboard
   â–¡ AJAX : refresh stats sans reload
   â–¡ Lien depuis header et simulation
   âœ“ Vue d'ensemble du systÃ¨me

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DURÃ‰E TOTALE ESTIMÃ‰E : 1h48 (108 minutes)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BÃ‰NÃ‰FICES :
âœ“ CohÃ©rence architecturale : Simulation suit pattern Besoins/Dons/Achats
âœ“ Algorithme optimal : dispatch FIFO, gestion quantitÃ©s disponibles
âœ“ SÃ©paration responsabilitÃ©s : logique backend (Distribution.php), affichage frontend (vue)
âœ“ PrÃ©visualisation : utilisateur voit projection avant validation
âœ“ Annulation simple : recommencer simulation
âœ“ Optimisation SQL : vues pour performance (Ã©viter N+1 queries)
âœ“ AJAX : UX fluide sans reload pendant traitement
âœ“ TestabilitÃ© : mÃ©thodes statiques, PDO injectable
âœ“ ExtensibilitÃ© : ajout facile de nouvelles rÃ¨gles de dispatch

CONTRAINTES MÃ‰TIER :
âœ“ Simulation hors argent : categorie != 'argent' (argent gÃ©rÃ© sÃ©parÃ©ment par achats)
âœ“ Dispatch FIFO : besoins les plus anciens en premier, dons les plus anciens en premier
âœ“ QuantitÃ© disponible calculÃ©e : don.quantite - SUM(distributions)
âœ“ Validation globale : toutes les simulations validÃ©es ensemble
âœ“ IntÃ©gration achats : valider simulation = valider achats aussi
âœ“ Ratio projetÃ© : inclut simulations pour prÃ©visualisation

OPTIMISATIONS :
âœ“ Vues SQL : v_bngrc_besoins_avec_articles (Ã©vite JOIN rÃ©pÃ©tÃ©)
âœ“ Vues SQL : v_bngrc_dons_disponibles_par_type (calcul quantite_disponible en vue)
âœ“ Vues SQL : v_bngrc_resume_simulation (stats prÃ©-calculÃ©es)
âœ“ Barre progression dans controller : Ã©vite calculs dans vue (plus maintenable)
âœ“ AJAX avec loading : feedback visuel pendant traitement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIN DE LA TODOLIST MODULE SIMULATION & DISTRIBUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
