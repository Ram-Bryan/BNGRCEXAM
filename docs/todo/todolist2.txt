â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TODOLIST - MODULE DONS - RECONSTRUCTION COMPLÃˆTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PHASE 1 : BASE DE DONNÃ‰ES (Estimation: 10min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1.1 CrÃ©er la table `dons`
    â–¡ Colonnes : id (PK AUTO_INCREMENT), type_article_id (FK)
    â–¡ Colonnes : quantite (INT), date_don (DATE), donateur (VARCHAR), statut (ENUM)
    â–¡ Statut : ENUM('disponible', 'distribue', 'epuise') DEFAULT 'disponible'
    â–¡ Index : INDEX(type_article_id), INDEX(date_don), INDEX(statut)
    â± Temps estimÃ© : 4 min
    âœ“ Ã‰tat initial : table vide, 0 ligne

1.2 CrÃ©er la vue `vue_dons_complets`
    â–¡ SELECT d.*, ta.nom AS article_nom, ta.categorie
    â–¡ ta.prix_unitaire, ta.unite
    â–¡ (d.quantite * ta.prix_unitaire) AS montant_total
    â–¡ COALESCE(SUM(dist.quantite), 0) AS quantite_distribuee
    â–¡ (d.quantite - quantite_distribuee) AS quantite_disponible
    â–¡ JOIN type_articles ta ON d.type_article_id = ta.id
    â–¡ LEFT JOIN distributions dist ON dist.don_id = d.id AND dist.est_simulation = FALSE
    â–¡ GROUP BY d.id
    â± Temps estimÃ© : 6 min
    âœ“ Ã‰tat initial : vue vide car table dons vide


ğŸ“‹ PHASE 2 : MODÃˆLES (Estimation: 15min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2.1 CrÃ©er Don.php (app/models/)
    â–¡ Namespace models, use PDO
    â–¡ Properties PRIVÃ‰ES : id, type_article_id, quantite, date_don, donateur, statut
    â–¡ Constructor vide : public function __construct() {}
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : classe vide, aucun don en DB

2.2 Getters Don.php
    â–¡ getId(): ?int
    â–¡ getTypeArticleId(): ?int
    â–¡ getQuantite(): ?int
    â–¡ getDateDon(): ?string
    â–¡ getDonateur(): ?string
    â–¡ getStatut(): ?string
    â± Temps estimÃ© : 2 min

2.3 Setters Don.php (fluent interface)
    â–¡ setId(?int $id): self { $this->id = $id; return $this; }
    â–¡ setTypeArticleId(?int $type_article_id): self
    â–¡ setQuantite(?int $quantite): self
    â–¡ setDateDon(?string $date_don): self
    â–¡ setDonateur(?string $donateur): self
    â–¡ setStatut(?string $statut): self
    â± Temps estimÃ© : 2 min

2.4 MÃ©thodes CRUD Don.php
    â–¡ create(PDO $db): bool - INSERT avec prepared statement
    â–¡ findById(PDO $db, int $id): ?Don - SELECT avec setters
    â–¡ findAll(PDO $db): array - SELECT * ORDER BY date_don DESC
    â–¡ findAllComplete(PDO $db): array - SELECT * FROM vue_dons_complets
    â–¡ findAllDisponibles(PDO $db): array - WHERE quantite_disponible > 0 ORDER BY date_don ASC
    â–¡ update(PDO $db): bool - UPDATE dons SET ... WHERE id
    â–¡ delete(PDO $db): bool - DELETE FROM dons WHERE id
    â± Temps estimÃ© : 9 min
    âœ“ Ã‰tat initial DB : 0 dons aprÃ¨s findAll()


ğŸ“‹ PHASE 3 : DTO (Estimation: 12min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3.1 CrÃ©er DTODon.php (app/dto/)
    â–¡ Namespace dto
    â–¡ Properties PRIVÃ‰ES : id, type_article_id, quantite, date_don, donateur, statut
    â–¡ Properties PRIVÃ‰ES : article_nom, categorie, prix_unitaire, unite
    â–¡ Properties PRIVÃ‰ES : montant_total, quantite_distribuee, quantite_disponible
    â–¡ Constructor vide
    â± Temps estimÃ© : 3 min
    âœ“ Ã‰tat initial : aucun DTO, DB vide

3.2 Getters/Setters DTODon.php
    â–¡ 13 getters : getId(), getTypeArticleId(), getQuantite(), getDateDon(), etc.
    â–¡ 13 setters avec fluent interface : setId(?int $id): self
    â± Temps estimÃ© : 4 min

3.3 MÃ©thodes statiques et helpers DTODon
    â–¡ static fromArray(array $data): DTODon - utiliser setters (chaÃ®nage)
    â–¡ static fromArrayMultiple(array $dataArray): array
    â–¡ getQuantiteFormatee(): string - number_format($this->quantite)
    â–¡ getQuantiteDistribueeFormatee(): string
    â–¡ getQuantiteDisponibleFormatee(): string
    â–¡ getDateFormatee(): string - date('d/m/Y', strtotime())
    â–¡ getMontantFormate(): string - number_format avec 'Ar'
    â–¡ getCategorieClass(): string - match categorie
    â–¡ getStatutClass(): string - match statut
    â–¡ isDisponible(): bool - quantite_disponible > 0
    â–¡ isPeutSupprimer(): bool - quantite_disponible == quantite (pas distribuÃ©)
    â± Temps estimÃ© : 5 min


ğŸ“‹ PHASE 4 : CONTRÃ”LEUR (Estimation: 18min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4.1 CrÃ©er DonController.php (app/controllers/)
    â–¡ Namespace controllers
    â–¡ use models\Don, models\TypeArticle, Flight, PDO, dto\DTODon
    â–¡ TOUS LES MÃ‰THODES STATIC : public static function
    â–¡ Pas de constructor, pas de $this->db
    â–¡ Utiliser Flight::db() dans chaque mÃ©thode
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : aucun controller, pas de routes

4.2 MÃ©thode listDons()
    â–¡ public static function listDons(): void
    â–¡ $db = Flight::db()
    â–¡ $dons = Don::findAllComplete($db)
    â–¡ Calculer statistiques backend : $totalDons = count($dons)
    â–¡ Boucle foreach : $totalDisponible += $don->getQuantiteDisponible()
    â–¡ Boucle foreach : $totalDistribue += $don->getQuantiteDistribuee()
    â–¡ Flight::render('don/list', ['dons' => $dons, 'totalDons' => ..., ...])
    â± Temps estimÃ© : 4 min
    âœ“ Ã‰tat initial : affichera 0 dons (DB vide)

4.3 MÃ©thode showForm()
    â–¡ public static function showForm(): void
    â–¡ $db = Flight::db()
    â–¡ $typeArticles = TypeArticle::findAll($db)
    â–¡ Flight::render('don/form', ['typeArticles' => $typeArticles])
    â± Temps estimÃ© : 2 min

4.4 MÃ©thode create()
    â–¡ public static function create(): void
    â–¡ $db = Flight::db()
    â–¡ $request = Flight::request()
    â–¡ Extraire : type_article_id, quantite, date_don, donateur
    â–¡ CrÃ©er Don avec setters (fluent interface)
    â–¡ if ($don->create($db)) { $message = 'Don enregistrÃ© avec succÃ¨s !'; }
    â–¡ else { $message = 'Erreur lors de la crÃ©ation du don'; }
    â–¡ Toujours fetch $dons = Don::findAllComplete($db)
    â–¡ Toujours calculer $totalDons, $totalDisponible, $totalDistribue
    â–¡ Flight::render('don/list', [...]) avec message OU render 'don/form' avec message
    â–¡ GÃ©rer try/catch pour erreurs
    â± Temps estimÃ© : 6 min
    âœ“ CrÃ©ation : DB passe de 0 Ã  1 ligne

4.5 MÃ©thode delete($id)
    â–¡ public static function delete($id): void
    â–¡ $db = Flight::db()
    â–¡ $don = Don::findById($db, $id)
    â–¡ if (!$don) { $message = 'Don non trouvÃ©'; }
    â–¡ elseif ($don->delete($db)) { $message = 'Don supprimÃ© avec succÃ¨s !'; }
    â–¡ else { $message = 'Erreur lors de la suppression'; }
    â–¡ Toujours fetch $dons = Don::findAllComplete($db)
    â–¡ Toujours calculer stats backend
    â–¡ Flight::render('don/list', ['dons' => $dons, 'message' => $message, ...])
    â± Temps estimÃ© : 4 min


ğŸ“‹ PHASE 5 : VUES (Estimation: 18min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5.1 CrÃ©er form.php (app/views/don/)
    â–¡ <?php include header, link CSS forms.css
    â–¡ H1 : ğŸ Enregistrer un Don
    â–¡ Div message unifiÃ© : <?php if (!empty($message)): ?>
    â–¡ Info-box : note sur la distribution via Simulation
    â–¡ Form POST /dons/create
    â–¡ Input donateur (optionnel), input date_don (value=today)
    â–¡ Select type_article_id : foreach $typeArticles
    â–¡ Option display : nom [categorie] â€” unite (PAS ucfirst)
    â–¡ Input quantite (type=number, required, min=1)
    â–¡ Buttons : submit "Enregistrer le don", annuler (retour /dons)
    â± Temps estimÃ© : 6 min
    âœ“ Ã‰tat initial : formulaire vide, DB 0 don

5.2 CrÃ©er list.php (app/views/don/)
    â–¡ <?php include header, link CSS dons.css
    â–¡ Header : H1 + boutons (Nouveau don, Distribution)
    â–¡ Div message unifiÃ© : <?php if (!empty($message)): ?>
    â–¡ Info-cards avec statistiques backend : $totalDons, $totalDisponible, $totalDistribue
    â–¡ Empty state si empty($dons) : affiche "Aucun don enregistrÃ©"
    â–¡ Table avec thead : ID, Date, Donateur, Article, CatÃ©gorie, QuantitÃ©, Disponible, Statut, Actions
    â–¡ Tbody foreach $dons : UTILISER GETTERS uniquement
    â–¡ $don->getId(), $don->getDateFormatee(), $don->getDonateur()
    â–¡ $don->getArticleNom(), $don->getCategorie() (PAS ucfirst)
    â–¡ Badge categorie : badge-<?php echo $don->getCategorie(); ?>
    â–¡ $don->getQuantiteFormatee(), $don->getUnite()
    â–¡ Si $don->isDisponible() : afficher quantite disponible formatÃ©e
    â–¡ Badge statut : $don->isDisponible() ? 'Disponible' : 'DistribuÃ©'
    â–¡ Actions : si $don->isPeutSupprimer() afficher form delete avec confirm
    â–¡ Sinon : span "DÃ©jÃ  distribuÃ©"
    â± Temps estimÃ© : 8 min
    âœ“ Ã‰tat initial : empty state visible, 0 ligne table

5.3 VÃ©rifier includes/header.php et footer.php
    â–¡ Header : logo, navigation, liens actifs
    â–¡ Footer : copyright, liens utiles
    â± Temps estimÃ© : 2 min

5.4 CSS dons.css et forms.css
    â–¡ .badge-satisfied { background: #28a745; }
    â–¡ .badge-not-satisfied { background: #dc3545; }
    â–¡ .badge-nature, .badge-argent, .badge-material
    â–¡ .info-cards, .info-card (blue, green, orange)
    â–¡ .empty-state, .btn, .btn-success, .btn-danger
    â± Temps estimÃ© : 2 min


ğŸ“‹ PHASE 6 : ROUTES (Estimation: 2min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6.1 DÃ©clarer routes dons (app/routes.php)
    â–¡ use controllers\DonController
    â–¡ Flight::route('GET /dons', [DonController::class, 'listDons'])
    â–¡ Flight::route('GET /dons/ajout', [DonController::class, 'showForm'])
    â–¡ Flight::route('POST /dons/create', [DonController::class, 'create'])
    â–¡ Flight::route('POST /dons/@id/delete', [DonController::class, 'delete'])
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : routes non dÃ©clarÃ©es


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RÃ‰SUMÃ‰ Ã‰TAT INITIAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Base de donnÃ©es : Table dons VIDE (0 ligne)
âœ“ Vue vue_dons_complets : VIDE car table source vide
âœ“ Model Don.php : findAll() retourne array vide []
âœ“ DTO DTODon : fromArrayMultiple([]) retourne []
âœ“ Controller : listDons() affichera empty state
âœ“ Vue list.php : affiche "Aucun don enregistrÃ©" + bouton Nouveau don
âœ“ Vue form.php : formulaire vide prÃªt pour premier don
âœ“ AprÃ¨s create() : DB passe de 0 Ã  1 ligne, list affiche 1 don

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FONCTIONNALITÃ‰S CLÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Enregistrement dons
   â–¡ Formulaire avec type_article, quantite, date_don, donateur (optionnel)
   â–¡ Validation backend : quantite > 0, type_article_id existe
   â–¡ INSERT dans table dons avec statut 'disponible'
   â–¡ Message succÃ¨s/erreur affichÃ© dans liste
   âœ“ Ã‰volution DB : 0 â†’ 1 â†’ 2 â†’ ... dons

2. Liste des dons
   â–¡ Affichage vide si DB = 0 dons
   â–¡ Table complÃ¨te avec toutes infos (vue_dons_complets)
   â–¡ Statistiques calculÃ©es backend : total, disponible, distribuÃ©
   â–¡ Badge catÃ©gorie (nature/argent/material)
   â–¡ Badge statut (disponible/distribuÃ©)
   â–¡ Actions conditionnelles : supprimer si non distribuÃ©

3. Suppression don
   â–¡ VÃ©rification : don existe + quantite_disponible == quantite (pas distribuÃ©)
   â–¡ DELETE avec confirmation JavaScript
   â–¡ Message succÃ¨s/erreur
   âœ“ Ã‰volution DB : N dons â†’ N-1 dons

4. IntÃ©gration avec distributions
   â–¡ Vue vue_dons_complets calcule quantite_distribuee via LEFT JOIN distributions
   â–¡ quantite_disponible = quantite - quantite_distribuee
   â–¡ isDisponible() : quantite_disponible > 0
   â–¡ isPeutSupprimer() : quantite_distribuee == 0

5. Messages utilisateur
   â–¡ Jamais de redirect avec URL params
   â–¡ Toujours $message variable locale
   â–¡ Toujours render avec fetch complet des donnÃ©es
   â–¡ Message unifiÃ© dans vue : <?php if (!empty($message)): ?>

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DURÃ‰E TOTALE ESTIMÃ‰E : 1h15 (75 minutes)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BÃ‰NÃ‰FICES :
âœ“ CohÃ©rence architecturale : Dons suit pattern Besoins
âœ“ Encapsulation complÃ¨te : DTODon avec getters/setters
âœ“ SÃ©paration responsabilitÃ©s : logique backend, affichage frontend
âœ“ Messages propres : pas de URL params, variable locale
âœ“ TestabilitÃ© : mÃ©thodes statiques, PDO injectable
âœ“ UX claire : statistiques calculÃ©es, badges visuels
