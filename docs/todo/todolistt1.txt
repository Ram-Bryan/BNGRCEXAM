â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TODOLIST - MODULE BESOINS - RECONSTRUCTION COMPLÃˆTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PHASE 1 : BASE DE DONNÃ‰ES (Estimation: 15min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1.1 CrÃ©er la table `besoin`
    â–¡ Colonnes : id (PK AUTO_INCREMENT), ville_id (FK), type_article_id (FK)
    â–¡ Colonnes : quantite (DECIMAL), date_demande (DATE)
    â–¡ Index : INDEX(ville_id), INDEX(type_article_id), INDEX(date_demande)
    â± Temps estimÃ© : 5 min

1.2 CrÃ©er la table `historique_besoin`
    â–¡ Colonnes : id (PK AUTO_INCREMENT), besoin_id (FK), quantite (DECIMAL)
    â–¡ Colonnes : date_enregistrement (DATETIME DEFAULT CURRENT_TIMESTAMP)
    â–¡ Index : INDEX(besoin_id), INDEX(date_enregistrement)
    â–¡ Contrainte : ON DELETE CASCADE sur besoin_id
    â± Temps estimÃ© : 3 min

1.3 CrÃ©er la vue `vue_besoins_complets`
    â–¡ SELECT b.*, v.nom AS ville_nom, v.nbsinistres, v.region_id
    â–¡ r.nom AS region_nom, ta.nom AS article_nom, ta.categorie
    â–¡ ta.prix_unitaire, ta.unite
    â–¡ JOIN ville v, region r, type_articles ta
    â–¡ Calculer montant_total : (quantite * prix_unitaire)
    â± Temps estimÃ© : 4 min

1.4 CrÃ©er la vue `vue_besoins_satisfaction`
    â–¡ Ã‰tendre vue_besoins_complets avec agrÃ©gations distributions
    â–¡ COALESCE(SUM(d.quantite), 0) AS quantite_recue
    â–¡ (b.quantite - quantite_recue) AS quantite_restante
    â–¡ (quantite_recue / b.quantite * 100) AS ratio_satisfaction
    â–¡ LEFT JOIN distributions d ON d.besoin_id = b.id
    â–¡ GROUP BY b.id
    â± Temps estimÃ© : 3 min


ğŸ“‹ PHASE 2 : MODÃˆLES (Estimation: 20min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2.1 CrÃ©er Besoin.php (app/models/)
    â–¡ Properties privÃ©es : id, ville_id, type_article_id, quantite, date_demande
    â–¡ Getters/Setters pour chaque propriÃ©tÃ© (fluent interface : return $this)
    â–¡ create(PDO $db): bool - INSERT avec PDO prepared statement
    â–¡ findById(PDO $db, int $id): ?Besoin - SELECT avec FETCH_ASSOC
    â–¡ findAll(PDO $db): array - SELECT * FROM besoin ORDER BY date_demande DESC
    â± Temps estimÃ© : 8 min

2.2 MÃ©thodes avancÃ©es Besoin.php
    â–¡ findAllComplete(PDO $db): array - SELECT * FROM vue_besoins_complets
    â–¡ findCompleteById(PDO $db, int $id): ?array - vue_besoins_complets WHERE id
    â–¡ update(PDO $db): bool - UPDATE dynamique (if field !== null)
    â–¡ updateQuantite(PDO $db): bool - UPDATE besoin SET quantite WHERE id
    â–¡ delete(PDO $db): bool - DELETE FROM besoin WHERE id
    â± Temps estimÃ© : 7 min

2.3 CrÃ©er HistoriqueBesoin.php (app/models/)
    â–¡ Properties privÃ©es : id, besoin_id, quantite, date_enregistrement
    â–¡ Getters/Setters fluent interface
    â–¡ create(PDO $db): bool - INSERT historique
    â–¡ findByBesoinId(PDO $db, int $besoin_id): array - ORDER BY date DESC
    â± Temps estimÃ© : 5 min


ğŸ“‹ PHASE 3 : DTO (Estimation: 10min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3.1 CrÃ©er DTOBesoin.php (app/dto/)
    â–¡ Properties PRIVÃ‰ES avec types : id, ville_id, type_article_id, quantite
    â–¡ Properties : date_demande, ville_nom, nbsinistres, region_id, region_nom
    â–¡ Properties : article_nom, categorie, prix_unitaire, unite, montant_total
    â–¡ Properties satisfaction : quantite_recue, quantite_restante, ratio_satisfaction
    â–¡ CrÃ©er 36 mÃ©thodes (18 getters + 18 setters) avec fluent interface
    â± Temps estimÃ© : 6 min

3.2 MÃ©thodes statiques et helpers DTOBesoin
    â–¡ static fromArray(array $data): DTOBesoin - utiliser setters (chaÃ®nage)
    â–¡ static fromArrayMultiple(array $dataArray): array
    â–¡ getCategorieClass(): string - match categorie to CSS class
    â–¡ getDateFormatee(): string - date('d/m/Y')
    â–¡ getMontantTotalFormate(): string - number_format avec sÃ©parateurs
    â–¡ getQuantiteFormatee(), getPrixUnitaireFormate()
    â–¡ getRatioClass(), getRatioFormate()
    â± Temps estimÃ© : 4 min


ğŸ“‹ PHASE 4 : CONTRÃ”LEUR (Estimation: 15min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4.1 CrÃ©er BesoinController.php (app/controllers/)
    â–¡ Namespace controllers, use models\*, dto\DTOBesoin, Flight, PDO
    â–¡ TOUS LES MÃ‰THODES STATIC : public static function
    â–¡ Pas de constructor, pas de $this->db
    â–¡ Utiliser Flight::db() dans chaque mÃ©thode
    â± Temps estimÃ© : 2 min

4.2 MÃ©thode showForm()
    â–¡ public static function showForm(): void
    â–¡ $villes = Ville::findAllComplete(Flight::db())
    â–¡ $typeArticles = TypeArticle::findAll(Flight::db())
    â–¡ Flight::render('besoin/form', ['villes' => $villes, ...])
    â± Temps estimÃ© : 2 min

4.3 MÃ©thode create()
    â–¡ public static function create(): void
    â–¡ $request = Flight::request() - extraire data
    â–¡ CrÃ©er Besoin avec setters (ville_id, type_article_id, quantite, date_demande)
    â–¡ $besoin->create(Flight::db())
    â–¡ CrÃ©er HistoriqueBesoin->create() pour tracer quantitÃ© initiale
    â–¡ Flight::redirect('/besoins?message=' . urlencode('Besoin crÃ©Ã© avec succÃ¨s'))
    â–¡ GÃ©rer try/catch pour erreurs
    â± Temps estimÃ© : 3 min

4.4 MÃ©thode listBesoins()
    â–¡ public static function listBesoins(): void
    â–¡ $besoinsData = Besoin::findAllComplete(Flight::db())
    â–¡ $besoins = DTOBesoin::fromArrayMultiple($besoinsData)
    â–¡ Flight::render('besoin/list', ['besoins' => $besoins])
    â± Temps estimÃ© : 2 min

4.5 MÃ©thode showEditForm($id)
    â–¡ public static function showEditForm($id): void
    â–¡ $besoinData = Besoin::findCompleteById(Flight::db(), $id)
    â–¡ if (!$besoinData) redirect avec message erreur
    â–¡ $besoin = DTOBesoin::fromArray($besoinData)
    â–¡ $villes = Ville::findAllComplete(Flight::db())
    â–¡ Flight::render('besoin/edit', ['besoin' => $besoin, 'villes' => $villes])
    â± Temps estimÃ© : 2 min

4.6 MÃ©thode update($id)
    â–¡ public static function update($id): void
    â–¡ $request = Flight::request(), extraire ville_id et quantite
    â–¡ Charger Besoin::findById(), vÃ©rifier existence
    â–¡ $besoin->setVilleId(ville_id)->setQuantite(quantite)
    â–¡ $besoin->update(Flight::db()) - utiliser update dynamique
    â–¡ CrÃ©er HistoriqueBesoin pour tracer la modification
    â–¡ redirect('/besoins?message=Besoin mis Ã  jour avec succÃ¨s')
    â± Temps estimÃ© : 3 min

4.7 MÃ©thodes delete($id) et showHistorique($id)
    â–¡ delete: findById, delete(), redirect avec message
    â–¡ showHistorique: findCompleteById + HistoriqueBesoin::findByBesoinId
    â–¡ CrÃ©er DTO, render 'besoin/historique'
    â± Temps estimÃ© : 1 min


ğŸ“‹ PHASE 5 : VUES (Estimation: 20min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5.1 CrÃ©er form.php (app/views/besoin/)
    â–¡ <?php include header, link CSS forms.css
    â–¡ Div message : <?php if (isset($_GET['message'])): ?>
    â–¡ Form POST /besoins/create avec select ville_id (foreach $villes)
    â–¡ Select type_article_id avec optgroup simplifiÃ© (grouper par categorie d'abord)
    â–¡ Input quantite (type=number), input date_demande (value=today)
    â–¡ Buttons submit + annuler (retour /besoins)
    â± Temps estimÃ© : 6 min

5.2 CrÃ©er list.php (app/views/besoin/)
    â–¡ <?php include header, link CSS besoins.css
    â–¡ Div message unifiÃ© : isset($_GET['message'])
    â–¡ Header avec titre + bouton "Nouvelle demande"
    â–¡ Table avec thead (ID, RÃ©gion, Ville, Article, CatÃ©gorie, QuantitÃ©, etc.)
    â–¡ Tbody foreach $besoins : utiliser GETTERS ($besoin->getId(), getVilleNom())
    â–¡ Badge categorie : getCategorieClass(), getCategorie() - PAS ucfirst
    â–¡ Actions : liens historique, edit, form delete avec confirm
    â–¡ Empty state si vide
    â± Temps estimÃ© : 5 min

5.3 CrÃ©er edit.php (app/views/besoin/)
    â–¡ <?php include header, link CSS forms.css
    â–¡ H1 avec $besoin->getId()
    â–¡ Div message unifiÃ©
    â–¡ Besoin-info div avec info-grid : UTILISER GETTERS partout
    â–¡ Form POST /besoins/{id}/update avec select ville_id + input quantite
    â–¡ Select ville avec option selected sur ville actuelle
    â–¡ Buttons : submit, annuler, voir historique
    â± Temps estimÃ© : 5 min

5.4 CrÃ©er historique.php (app/views/besoin/)
    â–¡ <?php include header, link CSS besoins.css
    â–¡ H1 avec $besoin->getId(), bouton retour
    â–¡ Besoin-info identique Ã  edit.php (UTILISER GETTERS)
    â–¡ Div timeline avec foreach $historique
    â–¡ Timeline-item avec date, quantite formatÃ©e
    â–¡ Empty state si pas d'historique
    â± Temps estimÃ© : 4 min


ğŸ“‹ PHASE 6 : ROUTES (Estimation: 2min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6.1 DÃ©clarer routes besoins (app/routes.php)
    â–¡ use controllers\BesoinController
    â–¡ Flight::route('GET /besoins', [BesoinController::class, 'listBesoins'])
    â–¡ Flight::route('GET /besoins/ajout', [BesoinController::class, 'showForm'])
    â–¡ Flight::route('POST /besoins/create', [BesoinController::class, 'create'])
    â–¡ Flight::route('GET /besoins/@id/edit', [BesoinController::class, 'showEditForm'])
    â–¡ Flight::route('POST /besoins/@id/update', [BesoinController::class, 'update'])
    â–¡ Flight::route('POST /besoins/@id/delete', [BesoinController::class, 'delete'])
    â–¡ Flight::route('GET /besoins/@id/historique', [BesoinController::class, 'showHistorique'])
    â± Temps estimÃ© : 2 min


ğŸ“‹ PHASE 7 : CSS (Estimation: 8min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

7.1 CrÃ©er/AmÃ©liorer besoins.css (public/assets/css/)
    â–¡ th { background-color: #007bff; }
    â–¡ .actions { display: flex; gap: 8px; }
    â–¡ .timeline avec ::before (ligne verticale gradient)
    â–¡ .timeline-item avec hover transform, box-shadow
    â–¡ .timeline-item::before avec emoji ğŸ“Œ
    â–¡ .timeline-date et .timeline-quantite avec icÃ´nes
    â–¡ .message unifiÃ© (background, border-left, padding, shadow)
    â± Temps estimÃ© : 5 min

7.2 VÃ©rifier forms.css (public/assets/css/)
    â–¡ .page-container, .form-group, .buttons
    â–¡ .besoin-info, .info-grid, .info-item
    â–¡ .warning-box, .info-box
    â–¡ Responsive design (media queries)
    â± Temps estimÃ© : 3 min


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RÃ‰SUMÃ‰ TEMPS TOTAL ESTIMÃ‰ : 1H30
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 1 (DB)         : 15min
Phase 2 (ModÃ¨les)    : 20min
Phase 3 (DTO)        : 10min
Phase 4 (ContrÃ´leur) : 15min
Phase 5 (Vues)       : 20min
Phase 6 (Routes)     : 2min
Phase 7 (CSS)        : 8min

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PRINCIPES ARCHITECTURAUX Ã€ RESPECTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ENCAPSULATION
   â€¢ Toutes les propriÃ©tÃ©s DTO PRIVÃ‰ES avec getters/setters
   â€¢ Pas d'accÃ¨s direct : $besoin->id âŒ -> $besoin->getId() âœ…

âœ… MÃ‰THODES STATIQUES
   â€¢ BesoinController : ALL STATIC methods
   â€¢ Pas de constructor, pas de $this
   â€¢ Flight::db() dans chaque mÃ©thode

âœ… SQL DYNAMIQUE
   â€¢ Besoin::update() construit SQL selon champs non-null
   â€¢ if ($this->ville_id !== null) $sql .= "ville_id = :ville_id, "
   â€¢ Ã‰vite UPDATE inutile si aucun champ

âœ… MESSAGES UNIFIÃ‰S
   â€¢ Un seul div .message avec $_GET['message']
   â€¢ Pas de divs sÃ©parÃ©s success/error
   â€¢ urlencode() dans redirects

âœ… HTML PUR
   â€¢ Pas de echo '</optgroup>' ou echo '<div>'
   â€¢ Utiliser <?php if: ?> ... <?php endif; ?>
   â€¢ Balises HTML en pur HTML

âœ… PAS UCFIRST()
   â€¢ CatÃ©gories stockÃ©es en minuscules en DB
   â€¢ Affichage direct sans transformation
   â€¢ CSS peut faire text-transform si nÃ©cessaire

âœ… GETTERS PARTOUT
   â€¢ Dans TOUTES les vues : $besoin->getId()
   â€¢ Jamais $besoin->id, $besoin->ville_nom, etc.
   â€¢ Respecter encapsulation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIN DE LA TODOLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
