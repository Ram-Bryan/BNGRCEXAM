â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TODOLIST - MODULE ACHATS - RECONSTRUCTION COMPLÃˆTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PHASE 1 : BASE DE DONNÃ‰ES (Estimation: 12min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1.1 CrÃ©er la table `bngrc_achat`
    â–¡ Colonnes : id (PK AUTO_INCREMENT), besoin_id (FK)
    â–¡ Colonnes : quantite (INT), montant_ht (DECIMAL 15,2)
    â–¡ Colonnes : frais_percent (INT), montant_frais (DECIMAL 15,2)
    â–¡ Colonnes : montant_total (DECIMAL 15,2), date_achat (DATE)
    â–¡ Colonnes : valide (BOOLEAN DEFAULT FALSE)
    â–¡ Index : INDEX(besoin_id), INDEX(date_achat), INDEX(valide)
    â± Temps estimÃ© : 5 min
    âœ“ Ã‰tat initial : table vide, 0 ligne

1.2 CrÃ©er la vue `v_bngrc_achats_complets`
    â–¡ SELECT a.*, b.type_article_id
    â–¡ ta.nom AS article_nom, ta.categorie, ta.prix_unitaire, ta.unite
    â–¡ b.quantite AS besoin_quantite, b.ville_id
    â–¡ v.nom AS ville_nom, r.nom AS region_nom
    â–¡ FROM bngrc_achat a
    â–¡ JOIN bngrc_besoin b ON a.besoin_id = b.id
    â–¡ JOIN bngrc_type_articles ta ON b.type_article_id = ta.id
    â–¡ JOIN bngrc_villes v ON b.ville_id = v.id
    â–¡ JOIN bngrc_regions r ON v.region_id = r.id
    â± Temps estimÃ© : 5 min
    âœ“ Ã‰tat initial : vue vide car table achats vide

1.3 CrÃ©er la vue `v_bngrc_argent_disponible`
    â–¡ SELECT 
        COALESCE(SUM(d.quantite), 0) AS total_dons_argent,
        COALESCE(SUM(CASE WHEN a.valide = TRUE THEN a.montant_total ELSE 0 END), 0) AS total_achats_valides,
        (total_dons_argent - total_achats_valides) AS argent_disponible
    â–¡ FROM bngrc_dons d
    â–¡ JOIN bngrc_type_articles ta ON d.type_article_id = ta.id
    â–¡ LEFT JOIN bngrc_achat a ON 1=1
    â–¡ WHERE ta.categorie = 'argent'
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : total_dons_argent > 0 si dons existent, achats = 0


ğŸ“‹ PHASE 2 : MODÃˆLES (Estimation: 20min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2.1 CrÃ©er Achat.php (app/models/)
    â–¡ Namespace models, use PDO
    â–¡ Properties PRIVÃ‰ES : id, besoin_id, quantite, montant_ht, frais_percent
    â–¡ Properties PRIVÃ‰ES : montant_frais, montant_total, date_achat, valide
    â–¡ Constructor vide : public function __construct() {}
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : classe vide, aucun achat en DB

2.2 Getters Achat.php
    â–¡ getId(): ?int
    â–¡ getBesoinId(): ?int
    â–¡ getQuantite(): ?int
    â–¡ getMontantHt(): ?float
    â–¡ getFraisPercent(): ?int
    â–¡ getMontantFrais(): ?float
    â–¡ getMontantTotal(): ?float
    â–¡ getDateAchat(): ?string
    â–¡ isValide(): bool (ou getValide)
    â± Temps estimÃ© : 2 min

2.3 Setters Achat.php (fluent interface)
    â–¡ setId(?int $id): self { $this->id = $id; return $this; }
    â–¡ setBesoinId(?int $besoin_id): self
    â–¡ setQuantite(?int $quantite): self
    â–¡ setMontantHt(?float $montant_ht): self
    â–¡ setFraisPercent(?int $frais_percent): self
    â–¡ setMontantFrais(?float $montant_frais): self
    â–¡ setMontantTotal(?float $montant_total): self
    â–¡ setDateAchat(?string $date_achat): self
    â–¡ setValide(bool $valide): self
    â± Temps estimÃ© : 3 min

2.4 MÃ©thodes CRUD Achat.php
    â–¡ create(PDO $db): bool - INSERT avec prepared statement
    â–¡ findById(PDO $db, int $id): ?Achat - SELECT avec setters
    â–¡ findAll(PDO $db): array - SELECT * FROM v_bngrc_achats_complets
    â–¡ findAllByVille(PDO $db, int $ville_id): array
    â–¡ findNonValides(PDO $db): array - WHERE valide = FALSE (alias findEnAttente)
    â–¡ findEnAttente(PDO $db): array - alias de findNonValides
    â–¡ delete(PDO $db): bool - DELETE FROM bngrc_achat WHERE id (seulement si non validÃ©)
    â± Temps estimÃ© : 7 min
    âœ“ Ã‰tat initial DB : 0 achats aprÃ¨s findAll()

2.5 MÃ©thodes mÃ©tier Achat.php
    â–¡ static getArgentDisponible(PDO $db): float - SELECT argent_disponible FROM v_bngrc_argent_disponible
    â–¡ static existeAchatNonValide(PDO $db, int $besoin_id): bool - COUNT achats non validÃ©s pour ce besoin
    â–¡ static validerTous(PDO $db): bool - UPDATE bngrc_achat SET valide = TRUE WHERE valide = FALSE
    â–¡ static validerTous(PDO $db): bool - AUSSI crÃ©er don + distribution pour chaque achat validÃ©
    â–¡ static annulerSimulation(PDO $db): bool - DELETE FROM bngrc_achat WHERE valide = FALSE
    â± Temps estimÃ© : 6 min
    âœ“ Validation : achats en attente â†’ crÃ©er dons matÃ©riels + distributions


ğŸ“‹ PHASE 3 : DTO (Estimation: 10min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3.1 CrÃ©er DTOAchat.php (app/dto/)
    â–¡ Namespace dto
    â–¡ Properties PRIVÃ‰ES : id, besoin_id, quantite, montant_ht, frais_percent
    â–¡ Properties PRIVÃ‰ES : montant_frais, montant_total, date_achat, valide
    â–¡ Properties PRIVÃ‰ES : article_nom, categorie, prix_unitaire, unite
    â–¡ Properties PRIVÃ‰ES : ville_nom, region_nom, besoin_quantite
    â–¡ Constructor vide
    â± Temps estimÃ© : 3 min
    âœ“ Ã‰tat initial : aucun DTO, DB vide

3.2 Getters/Setters DTOAchat.php
    â–¡ 16 getters : getId(), getBesoinId(), getQuantite(), getMontantHt(), etc.
    â–¡ 16 setters avec fluent interface : setId(?int $id): self
    â± Temps estimÃ© : 4 min

3.3 MÃ©thodes statiques et helpers DTOAchat
    â–¡ static fromArray(array $data): DTOAchat - utiliser setters (chaÃ®nage)
    â–¡ static fromArrayMultiple(array $dataArray): array
    â–¡ getDateFormatee(): string - date('d/m/Y', strtotime())
    â–¡ getMontantHtFormate(): string - number_format($this->montant_ht, 0, '', ' ') . ' Ar'
    â–¡ getMontantFraisFormate(): string
    â–¡ getMontantTotalFormate(): string
    â–¡ getStatutBadge(): string - isValide() ? 'ValidÃ©' : 'En attente'
    â–¡ getStatutClass(): string - isValide() ? 'badge-success' : 'badge-warning'
    â–¡ getCategorieClass(): string - match categorie
    â–¡ isPeutSupprimer(): bool - !$this->valide
    â± Temps estimÃ© : 3 min


ğŸ“‹ PHASE 4 : CONTRÃ”LEUR (Estimation: 25min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4.1 CrÃ©er AchatController.php (app/controllers/)
    â–¡ Namespace controllers
    â–¡ use models\Achat, models\Besoin, models\Ville, models\Configuration
    â–¡ use Flight, PDO, dto\DTOAchat
    â–¡ TOUS LES MÃ‰THODES STATIC : public static function
    â–¡ Pas de constructor, pas de $this->db
    â–¡ Utiliser Flight::db() dans chaque mÃ©thode
    â± Temps estimÃ© : 2 min
    âœ“ Ã‰tat initial : aucun controller, pas de routes

4.2 MÃ©thode listAchats()
    â–¡ public static function listAchats(): void
    â–¡ $db = Flight::db()
    â–¡ $ville_id = Flight::request()->query->ville_id ?? null
    â–¡ if ($ville_id) { $achats = Achat::findAllByVille($db, (int)$ville_id); }
    â–¡ else { $achats = Achat::findAll($db); }
    â–¡ $villes = Ville::findAllComplete($db) - pour filtre
    â–¡ $argentDisponible = Achat::getArgentDisponible($db)
    â–¡ $achatsEnAttente = Achat::findEnAttente($db)
    â–¡ $fraisPercent = Configuration::getValueAs($db, 'FRAIS_ACHAT_PERCENT', 'int', 10)
    â–¡ Calculer stats backend : $totalAchats = count($achats)
    â–¡ Boucle foreach : $totalMontant += $achat['montant_total']
    â–¡ Flight::render('achat/list', ['achats' => $achats, 'villes' => $villes, ...])
    â± Temps estimÃ© : 5 min
    âœ“ Ã‰tat initial : affichera 0 achats (DB vide)

4.3 MÃ©thode showBesoinsRestants()
    â–¡ public static function showBesoinsRestants(): void
    â–¡ $db = Flight::db()
    â–¡ $ville_id = Flight::request()->query->ville_id ?? null
    â–¡ $besoins = Besoin::findBesoinsRestantsAchats($db, $ville_id)
    â–¡ Boucle foreach : calculer $besoin['montant_restant'] = quantite_restante * prix_unitaire
    â–¡ $villes = Ville::findAllComplete($db)
    â–¡ $argentDisponible = Achat::getArgentDisponible($db)
    â–¡ $fraisPercent = Configuration::getValueAs($db, 'FRAIS_ACHAT_PERCENT', 'int', 10)
    â–¡ Flight::render('achat/besoins_restants', ['besoins' => $besoins, ...])
    â± Temps estimÃ© : 5 min

4.4 MÃ©thode create()
    â–¡ public static function create(): void
    â–¡ $db = Flight::db()
    â–¡ $request = Flight::request()
    â–¡ Extraire : besoin_id, quantite
    â–¡ try { VÃ©rifier existeAchatNonValide() â†’ redirect avec message erreur }
    â–¡ $besoinData = Besoin::findCompleteById($db, besoin_id)
    â–¡ VÃ©rifier categorie != 'argent' â†’ redirect erreur
    â–¡ Calculer : montantHt = quantite * prix_unitaire
    â–¡ RÃ©cupÃ©rer fraisPercent de Configuration
    â–¡ Calculer : montantFrais = montantHt * (frais_percent / 100)
    â–¡ Calculer : montantTotal = montantHt + montantFrais
    â–¡ VÃ©rifier argentDisponible >= montantTotal â†’ sinon redirect erreur
    â–¡ CrÃ©er Achat avec setters (fluent interface), valide = FALSE
    â–¡ if ($achat->create($db)) { redirect success } else { redirect error }
    â–¡ catch { redirect error }
    â± Temps estimÃ© : 7 min
    âœ“ CrÃ©ation : DB passe de 0 Ã  1 ligne (en attente)

4.5 MÃ©thode validerTous()
    â–¡ public static function validerTous(): void
    â–¡ $db = Flight::db()
    â–¡ try { if (Achat::validerTous($db)) { redirect success } else { redirect error } }
    â–¡ catch { redirect error }
    â± Temps estimÃ© : 2 min
    âœ“ Validation : achats en attente â†’ validÃ©s + dons crÃ©Ã©s + distributions crÃ©Ã©es

4.6 MÃ©thode annulerSimulation()
    â–¡ public static function annulerSimulation(): void
    â–¡ $db = Flight::db()
    â–¡ try { if (Achat::annulerSimulation($db)) { redirect success } else { redirect error } }
    â–¡ catch { redirect error }
    â± Temps estimÃ© : 2 min

4.7 MÃ©thode delete($id)
    â–¡ public static function delete($id): void
    â–¡ $db = Flight::db()
    â–¡ $achat = Achat::findById($db, (int)$id)
    â–¡ if (!$achat) { redirect error not_found }
    â–¡ if ($achat->isValide()) { redirect error 'Impossible de supprimer un achat validÃ©' }
    â–¡ if ($achat->delete($db)) { redirect success } else { redirect error }
    â–¡ catch { redirect error }
    â± Temps estimÃ© : 2 min


ğŸ“‹ PHASE 5 : VUES (Estimation: 22min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5.1 CrÃ©er besoins_restants.php (app/views/achat/)
    â–¡ <?php include header, link CSS achats.css
    â–¡ H1 : ğŸ›’ CrÃ©er des Achats
    â–¡ Div message unifiÃ© : <?php if (!empty($message)): ?>
    â–¡ Info-box argent disponible : afficher $argentDisponible formatÃ©
    â–¡ Info-box frais : "Frais d'achat : <?php echo $fraisPercent; ?>%"
    â–¡ Filtre ville : form GET avec select villes + bouton Filtrer
    â–¡ Empty state si empty($besoins) : "Aucun besoin restant Ã  acheter"
    â–¡ Table avec thead : ID, Ville, RÃ©gion, Article, CatÃ©gorie, Prix Unit., QtÃ© Restante, Montant Restant, Actions
    â–¡ Tbody foreach $besoins : afficher toutes les colonnes
    â–¡ Calculer montant avec frais : montantAvecFrais = montant_restant * (1 + frais_percent/100)
    â–¡ Form POST /achats/create : input hidden besoin_id
    â–¡ Input quantite (type=number, required, min=1, max=quantite_restante)
    â–¡ Button submit "Acheter" (avec icÃ´ne ğŸ›’)
    â± Temps estimÃ© : 8 min
    âœ“ Ã‰tat initial : affiche besoins non satisfaits catÃ©gorie nature/material

5.2 CrÃ©er list.php (app/views/achat/)
    â–¡ <?php include header, link CSS achats.css
    â–¡ Header : H1 + boutons (CrÃ©er achats, Liste besoins)
    â–¡ Div message unifiÃ© : <?php if (!empty($message)): ?>
    â–¡ Info-cards avec statistiques backend : argent disponible, total achats en attente, nombre achats
    â–¡ Boutons actions globales si achatsEnAttente :
        - Form POST /achats/valider : button "Valider tous les achats" (confirm JS)
        - Form POST /achats/annuler : button "Annuler la simulation" (confirm JS)
    â–¡ Filtre ville : form GET avec select villes + bouton Filtrer
    â–¡ Empty state si empty($achats) : "Aucun achat enregistrÃ©"
    â–¡ Table avec thead : ID, Date, Ville, Article, CatÃ©gorie, QuantitÃ©, Montant HT, Frais (%), Montant Frais, Montant Total, Statut, Actions
    â–¡ Tbody foreach $achats : afficher toutes colonnes formatÃ©es
    â–¡ Badge statut : valide ? 'ValidÃ©' (vert) : 'En attente' (orange)
    â–¡ Badge categorie : badge-<?php echo $achat['categorie']; ?>
    â–¡ Actions : si !valide â†’ form delete avec confirm
    â–¡ Sinon : span "ValidÃ©" (non supprimable)
    â± Temps estimÃ© : 10 min
    âœ“ Ã‰tat initial : empty state visible, 0 ligne table

5.3 CSS achats.css
    â–¡ .badge-warning { background: #ffc107; color: #333; }
    â–¡ .badge-success { background: #28a745; }
    â–¡ .badge-danger { background: #dc3545; }
    â–¡ .badge-nature, .badge-argent, .badge-material
    â–¡ .info-cards, .info-card (blue pour argent, orange pour attente, grey pour total)
    â–¡ .empty-state, .btn, .btn-primary, .btn-success, .btn-danger
    â–¡ .actions-globales { margin: 20px 0; display: flex; gap: 10px; }
    â± Temps estimÃ© : 4 min


ğŸ“‹ PHASE 6 : ROUTES (Estimation: 3min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6.1 DÃ©clarer routes achats (app/routes.php)
    â–¡ use controllers\AchatController
    â–¡ Flight::route('GET /achats', [AchatController::class, 'listAchats'])
    â–¡ Flight::route('GET /achats/besoins', [AchatController::class, 'showBesoinsRestants'])
    â–¡ Flight::route('POST /achats/create', [AchatController::class, 'create'])
    â–¡ Flight::route('POST /achats/valider', [AchatController::class, 'validerTous'])
    â–¡ Flight::route('POST /achats/annuler', [AchatController::class, 'annulerSimulation'])
    â–¡ Flight::route('POST /achats/@id/delete', [AchatController::class, 'delete'])
    â± Temps estimÃ© : 3 min
    âœ“ Ã‰tat initial : routes non dÃ©clarÃ©es


ğŸ“‹ PHASE 7 : INTÃ‰GRATION MENU (Estimation: 2min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

7.1 Ajouter lien Achats dans header.php
    â–¡ Ouvrir app/views/includes/header.php
    â–¡ Ajouter <a href="<?php echo $baseurl; ?>/achats" class="<?php echo $active == 'achats' ? 'active' : ''; ?>">
        ğŸ›’ Achats
      </a>
    â–¡ Entre Dons et Simulation
    â± Temps estimÃ© : 2 min


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RÃ‰SUMÃ‰ Ã‰TAT INITIAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Base de donnÃ©es : Table bngrc_achat VIDE (0 ligne)
âœ“ Vue v_bngrc_achats_complets : VIDE car table source vide
âœ“ Vue v_bngrc_argent_disponible : montre argent total (si dons argent existent)
âœ“ Model Achat.php : findAll() retourne array vide []
âœ“ DTO DTOAchat : fromArrayMultiple([]) retourne []
âœ“ Controller : listAchats() affichera empty state
âœ“ Vue list.php : affiche "Aucun achat enregistrÃ©" + bouton CrÃ©er achats
âœ“ Vue besoins_restants.php : affiche besoins non satisfaits (catÃ©gorie nature/material)
âœ“ AprÃ¨s create() : DB passe de 0 Ã  1 ligne (en attente), list affiche 1 achat

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FONCTIONNALITÃ‰S CLÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CrÃ©er un achat (simulation)
   â–¡ Page besoins_restants : liste des besoins non satisfaits (catÃ©gorie nature/material uniquement)
   â–¡ Filtre par ville optionnel
   â–¡ Pour chaque besoin : form avec input quantite (max = quantite_restante)
   â–¡ Calcul automatique : montantHt = quantite * prix_unitaire
   â–¡ Calcul automatique : montantFrais = montantHt * (frais_percent / 100) [depuis Configuration]
   â–¡ Calcul automatique : montantTotal = montantHt + montantFrais
   â–¡ Validations backend :
       - VÃ©rifier qu'aucun achat non validÃ© n'existe dÃ©jÃ  pour ce besoin
       - VÃ©rifier categorie != 'argent' (pas d'achat d'argent)
       - VÃ©rifier argent_disponible >= montantTotal
   â–¡ INSERT avec valide = FALSE (simulation)
   â–¡ Redirect /achats avec message succÃ¨s/erreur
   âœ“ Ã‰volution DB : 0 â†’ 1 â†’ 2 â†’ ... achats en attente

2. Liste des achats
   â–¡ Affichage vide si DB = 0 achats
   â–¡ Table complÃ¨te avec toutes infos (v_bngrc_achats_complets)
   â–¡ Filtre par ville optionnel
   â–¡ Statistiques calculÃ©es backend : argent disponible, total achats en attente, total achats
   â–¡ Badge catÃ©gorie (nature/material uniquement en principe)
   â–¡ Badge statut : "En attente" (orange) ou "ValidÃ©" (vert)
   â–¡ Actions conditionnelles : supprimer si non validÃ©

3. Valider tous les achats
   â–¡ Bouton global "Valider tous les achats" (avec confirm JS)
   â–¡ Disponible seulement si achatsEnAttente non vide
   â–¡ Backend : UPDATE bngrc_achat SET valide = TRUE WHERE valide = FALSE
   â–¡ Backend : pour chaque achat validÃ© :
       - CrÃ©er un don matÃ©riel : INSERT INTO bngrc_dons (type_article_id, quantite, date_don, donateur)
       - CrÃ©er une distribution : INSERT INTO bngrc_distribution (don_id, besoin_id, quantite, date_distribution, est_simulation=FALSE)
   â–¡ Permet de satisfaire automatiquement les besoins achetÃ©s
   â–¡ Message succÃ¨s/erreur
   âœ“ Ã‰volution : achats en attente â†’ achats validÃ©s + dons crÃ©Ã©s + distributions crÃ©Ã©es

4. Annuler la simulation
   â–¡ Bouton global "Annuler la simulation" (avec confirm JS)
   â–¡ Disponible seulement si achatsEnAttente non vide
   â–¡ Backend : DELETE FROM bngrc_achat WHERE valide = FALSE
   â–¡ Message succÃ¨s
   âœ“ Ã‰volution : tous les achats en attente supprimÃ©s

5. Supprimer un achat
   â–¡ Action individuelle : form delete avec confirm JS
   â–¡ Disponible seulement si achat non validÃ©
   â–¡ VÃ©rification backend : achat existe + !valide
   â–¡ DELETE FROM bngrc_achat WHERE id
   â–¡ Message succÃ¨s/erreur
   âœ“ Ã‰volution DB : N achats â†’ N-1 achats

6. Gestion argent disponible
   â–¡ Vue v_bngrc_argent_disponible : calcul global
   â–¡ total_dons_argent = SUM(dons catÃ©gorie argent)
   â–¡ total_achats_valides = SUM(achats validÃ©s)
   â–¡ argent_disponible = total_dons_argent - total_achats_valides
   â–¡ Affichage dans toutes les pages achats (info-card)
   â–¡ Validation avant crÃ©ation : montantTotal <= argent_disponible

7. IntÃ©gration avec besoins et distributions
   â–¡ Achat crÃ©Ã© pour un besoin â†’ flag ce besoin (Ã©viter doublons)
   â–¡ Achat validÃ© â†’ crÃ©er don + distribution â†’ satisfaire besoin automatiquement
   â–¡ Vue besoins_restants : calculer montant_restant par besoin
   â–¡ Afficher frais en temps rÃ©el : montant_avec_frais visible avant crÃ©ation

8. Messages utilisateur
   â–¡ Jamais de message dans URL params (ou minimaliste : ?success=created)
   â–¡ Toujours redirect avec paramÃ¨tre simple
   â–¡ Affichage message unifiÃ© dans vues : <?php if (isset($_GET['success'])): ?>
   â–¡ Messages clairs : "Achat crÃ©Ã©", "Tous les achats validÃ©s", "Simulation annulÃ©e", etc.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DURÃ‰E TOTALE ESTIMÃ‰E : 1h34 (94 minutes)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BÃ‰NÃ‰FICES :
âœ“ CohÃ©rence architecturale : Achats suit pattern Besoins et Dons
âœ“ Encapsulation complÃ¨te : DTOAchat avec getters/setters
âœ“ SÃ©paration responsabilitÃ©s : logique backend, affichage frontend
âœ“ Gestion argent centralisÃ©e : vue v_bngrc_argent_disponible
âœ“ Simulation achats : crÃ©er/valider/annuler en batch
âœ“ IntÃ©gration automatique : achats validÃ©s â†’ dons + distributions
âœ“ UX claire : statistiques calculÃ©es, badges visuels, confirmations JS
âœ“ TestabilitÃ© : mÃ©thodes statiques, PDO injectable

CONTRAINTES MÃ‰TIER :
âœ“ Achats uniquement pour catÃ©gories nature/material (pas argent)
âœ“ Un seul achat en attente par besoin Ã  la fois
âœ“ Validation globale : tous les achats en attente validÃ©s ensemble
âœ“ CrÃ©ation don + distribution automatique lors de la validation
âœ“ Argent disponible : bloque crÃ©ation si insuffisant
âœ“ Frais d'achat : pourcentage configurable (table Configuration)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIN DE LA TODOLIST MODULE ACHATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
